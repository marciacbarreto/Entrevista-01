<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Entrevista IA - Login Seguro</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
</head>
<body class="bg-gradient-to-br from-indigo-50 via-white to-purple-50 min-h-screen">
  <div id="app"></div>

  <script>
    const { useState, useEffect, useRef, createElement: h } = React;

    function App() {
      const [isLoggedIn, setIsLoggedIn] = useState(false);
      const [email, setEmail] = useState("");
      const [senha, setSenha] = useState("");
      const [erro, setErro] = useState("");

      const loginCorreto = "admin@entrevistaia.com";
      const senhaCorreta = "2025ia";

      const handleLogin = () => {
        if (email.trim() === loginCorreto && senha.trim() === senhaCorreta) {
          setIsLoggedIn(true);
          setErro("");
        } else {
          setErro("E-mail ou senha incorretos. Tente novamente.");
        }
      };

      if (!isLoggedIn) {
        return h("div", { className:"flex items-center justify-center min-h-screen"},
          h("div", { className:"bg-white p-8 rounded-2xl shadow-xl w-full max-w-sm text-center" },
            h("h1",{className:"text-3xl font-bold text-indigo-700 mb-6"},"🔒 Entrar no Entrevista IA"),
            h("input",{
              type:"email", placeholder:"E-mail", value: email,
              onChange:e=>setEmail(e.target.value),
              className:"w-full mb-4 px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
            }),
            h("input",{
              type:"password", placeholder:"Senha", value: senha,
              onChange:e=>setSenha(e.target.value),
              className:"w-full mb-4 px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
            }),
            erro && h("p",{className:"text-red-500 text-sm mb-4"},erro),
            h("button",{
              onClick: handleLogin,
              className:"w-full bg-gradient-to-r from-indigo-600 to-purple-600 text-white py-3 rounded-lg font-semibold hover:from-indigo-700 hover:to-purple-700 transition-all"
            },"Entrar")
          )
        );
      }

      return h(EntrevistaIA);
    }

    // Funções de análise e cruzamento
    function extrairEmpresa(texto) {
      const match = texto.match(/na\s+([A-Z][\wÀ-ú\s&-]+)/i);
      return match ? match[1].trim() : "a empresa";
    }

    function extrairExperiencia(curriculo) {
      const frases = curriculo.split(/[\.\n]/).map(s => s.trim()).filter(Boolean);
      const relevantes = frases.filter(s =>
        /(atuei|suporte|atendimento|escuta ativa|organização|processo|cliente|melhoria|operações|coordenei)/i.test(s)
      );
      return relevantes.slice(0, 2).join(". ");
    }

    function detectarFerramentas(text) {
      const lista = ["Power BI","Excel","CRM","Salesforce","Trello","Monday","Jira","Oracle","SAP"];
      const encontradas = lista.filter(f => new RegExp(f,"i").test(text));
      return encontradas.length ? encontradas : ["ferramentas de CRM e relatórios analíticos"];
    }

    function detectarKPIs(text) {
      const lista = ["NPS","CSAT","SLA","produtividade","eficiência","tempo de resposta"];
      const encontrados = lista.filter(k => new RegExp(k,"i").test(text));
      return encontrados.length ? encontrados : ["indicadores de desempenho e qualidade"];
    }

    function gerarRespostaExecutiva(curriculo, vaga, empresa) {
      const experiencia = extrairExperiencia(curriculo);
      const ferramentas = detectarFerramentas(curriculo + vaga);
      const kpis = detectarKPIs(vaga);

      let bloco1 = experiencia
        ? `(1) O que fiz e como fiz:\n${experiencia}.`
        : "";

      let bloco2 = `(2) O que farei nesta oportunidade:\n` +
      `Na ${empresa}, irei aprimorar a integração entre atendimento e operação, mapeando fluxos e identificando gargalos que impactam o cliente. ` +
      `Focarei em alinhar a comunicação entre áreas e transformar feedbacks em melhorias práticas, mantendo a coerência com os valores e estratégias da empresa.`;

      let bloco3 = `(3) KPIs e métricas:\n` +
      `Acompanharei ${kpis.join(", ")} já adotados pela empresa, propondo planos de ação baseados em resultados reais e relatórios comparativos. ` +
      `Se necessário, complementarei com análises de eficiência e engajamento para reforçar decisões táticas.`;

      let bloco4 = `(4) Ferramentas e plano:\n` +
      `Usarei ${ferramentas.join(", ")} para consolidar dados, gerar insights e garantir visibilidade de performance. ` +
      `O objetivo é transformar dados em decisões e fortalecer a experiência entre equipe e cliente.`;

      return `✨ Resposta sugerida (modelo executivo e natural):\n\n${[bloco1, bloco2, bloco3, bloco4].filter(Boolean).join("\n\n")}`;
    }

    // Componente principal
    function EntrevistaIA() {
      const [curriculo, setCurriculo] = useState("");
      const [vaga, setVaga] = useState("");
      const [empresa, setEmpresa] = useState("");
      const [pergunta, setPergunta] = useState("");
      const [resposta, setResposta] = useState("");
      const [gravando, setGravando] = useState(false);
      const recRef = useRef(null);

      useEffect(() => {
        setEmpresa(extrairEmpresa(vaga));
      }, [vaga]);

      const alternarMic = () => {
        if (gravando && recRef.current) {
          recRef.current.stop();
          setGravando(false);
          return;
        }
        const SR = window.SpeechRecognition || window.webkitSpeechRecognition;
        if (!SR) {
          alert("Seu navegador não suporta reconhecimento de voz.");
          return;
        }
        const rec = new SR();
        rec.lang = "pt-BR";
        rec.onresult = (e) => {
          const texto = e.results[0][0].transcript;
          setPergunta(texto);
        };
        rec.onend = () => {
          setGravando(false);
          gerarResposta();
        };
        recRef.current = rec;
        setGravando(true);
        rec.start();
      };

      const gerarResposta = () => {
        if (!vaga.trim()) {
          setResposta("Por favor, insira a vaga e o currículo antes de gerar a resposta.");
          return;
        }
        const respostaFinal = gerarRespostaExecutiva(curriculo, vaga, empresa);
        setResposta(respostaFinal);
      };

      return h("div",{className:"max-w-5xl mx-auto p-5"},
        h("h2",{className:"text-3xl font-bold text-indigo-700 mb-2 text-center"},"🤖 Entrevista IA"),
        h("p",{className:"text-gray-500 mb-6 text-center"},"Gere respostas inteligentes baseadas no seu currículo, vaga e empresa."),

        h("div",{className:"grid md:grid-cols-2 gap-4"},
          h("textarea",{
            placeholder:"📄 Cole aqui seu currículo...",
            value: curriculo, onChange:e=>setCurriculo(e.target.value),
            className:"w-full h-40 p-4 border rounded-xl shadow-sm focus:ring-2 focus:ring-indigo-400"
          }),
          h("textarea",{
            placeholder:"📋 Cole aqui a descrição da vaga...",
            value: vaga, onChange:e=>setVaga(e.target.value),
            className:"w-full h-40 p-4 border rounded-xl shadow-sm focus:ring-2 focus:ring-indigo-400"
          })
        ),

        h("input",{
          placeholder:"🏢 Nome da empresa (detectado automaticamente)",
          value: empresa, onChange:e=>setEmpresa(e.target.value),
          className:"w-full mt-3 p-3 border rounded-xl shadow-sm focus:ring-2 focus:ring-indigo-400"
        }),

        h("div",{className:"mt-4 flex items-center gap-3"},
          h("textarea",{
            placeholder:"🎯 Pergunta do recrutador (opcional)...",
            value: pergunta, onChange:e=>setPergunta(e.target.value),
            className:"flex-1 h-16 p-4 border rounded-xl shadow-sm focus:ring-2 focus:ring-purple-400"
          }),
          h("button",{
            onClick: alternarMic,
            className:`px-5 py-3 rounded-full font-semibold text-white transition-all ${gravando?'bg-red-500':'bg-indigo-600'}`
          }, gravando ? "🎙 Gravando..." : "🎤 Microfone")
        ),

        h("button",{
          onClick: gerarResposta,
          className:"mt-4 w-full bg-purple-600 text-white py-3 rounded-lg font-semibold hover:bg-purple-700 transition-all"
        },"⚡ Atualizar Resposta"),

        resposta && h("div",{className:"mt-6 bg-white p-6 rounded-2xl shadow-lg border-l-4 border-indigo-600"},
          h("h3",{className:"text-xl font-bold text-indigo-700 mb-3"},"✨ Resposta sugerida:"),
          h("pre",{className:"whitespace-pre-wrap text-gray-800 leading-relaxed"},resposta)
        )
      );
    }

    ReactDOM.createRoot(document.getElementById("app")).render(React.createElement(App));
  </script>
</body>
</html>
