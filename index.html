<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Entrevista IA — Login + Entrevista</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
</head>
<body class="bg-gradient-to-br from-indigo-50 via-white to-purple-50 min-h-screen">
  <div id="app" class="max-w-6xl mx-auto p-4"></div>

  <script>
    const { useState, useEffect, useMemo, createElement: h } = React;

    /* ========================
       Utils “executivo” local
       ======================== */

    function pickTools(resume, job) {
      const t = [];
      const text = (resume + " " + job).toLowerCase();
      if (text.includes("power bi") || text.includes("bi")) t.push("Power BI");
      if (text.includes("excel")) t.push("Excel");
      if (text.includes("jira")) t.push("Jira");
      if (text.includes("crm")) t.push("CRM");
      if (text.includes("helpdesk")) t.push("Helpdesk");
      if (text.includes("okrs") || text.includes("okr")) t.push("OKRs");
      if (text.includes("nps")) t.push("NPS");
      if (text.includes("csat")) t.push("CSAT");
      if (text.includes("ces")) t.push("CES");
      if (text.includes("customer success") || text.includes("cs")) t.push("Customer Success");
      return [...new Set(t)];
    }

    function buildExecutiveAnswer(question, resume, job) {
      const tools = pickTools(resume, job);
      const toolsTxt = tools.length ? tools.join(", ") : "ferramentas de gestão e análise alinhadas ao contexto";

      const seniorTouch =
        "Aplicaria rituais leves de melhoria contínua (checkpoints semanais/mensais), com quadro de riscos e dependências, " +
        "e indicadores visíveis (painel de metas e progresso).";

      const cxBlock = (job.toLowerCase().includes("customer") || job.toLowerCase().includes("cx"))
        ? "No pilar de experiência do cliente (CX), estruturaria a jornada ponta a ponta, " +
          "definindo momentos de valor, SLAs/SLIs, e um fluxo claro de feedback → priorização → ação junto a Produto e Operações."
        : "";

      // resposta curta específica quando a pergunta é muito direta
      if ((question || "").toLowerCase().includes("estruturaria") ||
          (question || "").toLowerCase().includes("como você estruturaria") ||
          (question || "").toLowerCase().includes("como voce estruturaria")) {
        return (
          "Eu estruturaria a área em três frentes: (1) diagnóstico rápido da operação e jornada, " +
          "mapeando gargalos e definindo processos mínimos (SOPs, SLAs); (2) metas claras e OKRs por time, " +
          "com cadência semanal de entregas; (3) visibilidade de dados em tempo real via " + toolsTxt +
          ". " + cxBlock + " " + seniorTouch
        );
      }

      // modelo executivo padrão (encaixa bem na maioria das perguntas abertas)
      return (
        "Na experiência recente, atuei estruturando a área com foco em eficiência operacional e experiência do cliente. " +
        "Começo com um diagnóstico objetivo (fluxos, gargalos, responsabilidades) e traduzo isso em " +
        "processos simples, metas claras e uma cadência semanal de entregas. " +
        "Para escalar e dar previsibilidade, uso " + toolsTxt + " para unificar visão de indicadores (NPS/CSAT, taxa de resolução, retrabalho), " +
        "acompanhamento de backlog e priorização. " + cxBlock + " " + seniorTouch
      );
    }

    function makeSessionId() {
      return Math.random().toString(36).slice(2, 10);
    }

    /* ========================
       Login
       ======================== */

    function Login({ onOk }) {
      const [email, setEmail] = useState("");
      const [senha, setSenha] = useState("");
      const [erro, setErro] = useState("");

      const login = () => {
        const ok = email === "admin@entrevistaia.com" && senha === "2025ia";
        if (ok) { setErro(""); onOk(); }
        else setErro("E-mail ou senha incorretos.");
      };

      return h("div", { className: "min-h-screen flex items-center justify-center" },
        h("div", { className: "bg-white w-full max-w-md rounded-2xl shadow-xl p-8" },
          h("div", { className: "flex items-center space-x-3 mb-6" },
            h("div", { className: "w-10 h-10 bg-indigo-100 rounded-full flex items-center justify-center" }, "🔒"),
            h("h1", { className: "text-2xl font-bold text-indigo-700" }, "Entrar no Entrevista IA")
          ),
          h("input", {
            type: "email",
            placeholder: "E-mail",
            value: email,
            onChange: e => setEmail(e.target.value),
            className: "w-full mb-3 px-4 py-3 border rounded-lg focus:ring-2 focus:ring-indigo-500"
          }),
          h("input", {
            type: "password",
            placeholder: "Senha",
            value: senha,
            onChange: e => setSenha(e.target.value),
            className: "w-full mb-3 px-4 py-3 border rounded-lg focus:ring-2 focus:ring-indigo-500"
          }),
          erro && h("p", { className: "text-red-500 text-sm mb-3" }, erro),
          h("button", {
            onClick: login,
            className: "w-full bg-gradient-to-r from-indigo-600 to-purple-600 text-white py-3 rounded-lg font-semibold"
          }, "Entrar")
        )
      );
    }

    /* ========================
       Entrevista
       ======================== */

    function Interview() {
      const [sessionId, setSessionId] = useState(makeSessionId());

      const [resume, setResume] = useState("");
      const [job, setJob] = useState("");
      const [question, setQuestion] = useState("");

      const [answer, setAnswer] = useState(null);
      const [history, setHistory] = useState([]);
      const [isRecording, setIsRecording] = useState(false);

      // 🔄 LIMPA resposta quando a pergunta muda (evita ficar com a antiga)
      useEffect(() => { setAnswer(null); }, [question]);

      // ⚙️ Gera SEMPRE com valores atuais (nada de fechamento de escopo)
      const handleGenerate = () => {
        const q = question.trim();
        const cv = resume.trim();
        const j = job.trim();
        if (!q || !cv || !j) {
          setAnswer({
            title: "Complete os campos",
            text: "Preencha currículo, descrição da vaga e a pergunta para gerar a resposta.",
          });
          return;
        }
        const text = buildExecutiveAnswer(q, cv, j);
        const item = {
          timestamp: new Date().toLocaleTimeString("pt-BR", { hour: '2-digit', minute: '2-digit' }),
          question: q, text
        };
        setAnswer({ title: "Resposta sugerida (modelo executivo e natural):", text });
        setHistory(prev => [item, ...prev]);
      };

      const toggleMic = () => {
        if (!isRecording) {
          setIsRecording(true);
          setTimeout(() => {
            setIsRecording(false);
            // simulação: “captura” uma pergunta
            setQuestion("Como você estruturaria a área com foco em eficiência e CX?");
          }, 1800);
        } else {
          setIsRecording(false);
        }
      };

      const resetSession = () => {
        setResume("");
        setJob("");
        setQuestion("");
        setAnswer(null);
        setHistory([]);
        setSessionId(makeSessionId());
        window.scrollTo({ top: 0, behavior: "smooth" });
      };

      return h("div", { className: "max-w-6xl mx-auto p-4" },
        // Header
        h("div", { className: "bg-white rounded-xl shadow-sm p-4 mb-6 flex items-center justify-between" },
          h("div", { className: "flex items-center space-x-3" },
            h("div", { className: "w-10 h-10 bg-gradient-to-br from-indigo-600 to-purple-600 text-white rounded-lg flex items-center justify-center" }, "✨"),
            h("div", null,
              h("h1", { className: "text-lg font-bold text-gray-900" }, "Entrevista IA"),
              h("p", { className: "text-xs text-gray-500" }, `Sessão: ${sessionId}`)
            )
          ),
          h("div", { className: "flex items-center space-x-2" },
            h("button", {
              onClick: resetSession,
              className: "px-3 py-2 text-sm bg-gray-100 hover:bg-gray-200 rounded-lg"
            }, "Nova sessão")
          )
        ),

        // Onboarding (CV e Vaga)
        h("div", { className: "grid lg:grid-cols-2 gap-6 mb-6" },
          h("div", { className: "bg-white rounded-xl shadow p-6" },
            h("h3", { className: "font-semibold text-gray-900 mb-2" }, "📄 Seu currículo"),
            h("textarea", {
              className: "w-full h-48 px-4 py-3 border rounded-lg focus:ring-2 focus:ring-indigo-500 resize-none",
              placeholder: "Cole aqui seu currículo (experiências, resultados, ferramentas, métricas) ...",
              value: resume, onChange: e => setResume(e.target.value)
            })
          ),
          h("div", { className: "bg-white rounded-xl shadow p-6" },
            h("h3", { className: "font-semibold text-gray-900 mb-2" }, "📋 Descrição da vaga"),
            h("textarea", {
              className: "w-full h-48 px-4 py-3 border rounded-lg focus:ring-2 focus:ring-indigo-500 resize-none",
              placeholder: "Cole aqui a descrição da vaga ...",
              value: job, onChange: e => setJob(e.target.value)
            })
          )
        ),

        // Modo entrevista
        h("div", { className: "bg-white rounded-xl shadow p-6 mb-6" },
          h("div", { className: "flex items-center justify-between mb-3" },
            h("h3", { className: "font-semibold text-gray-900" }, "🎙️ Modo Entrevista"),
            h("div", { className: "flex items-center bg-gray-100 rounded-lg p-1" },
              h("button", {
                onClick: toggleMic,
                className: `px-3 py-1.5 rounded text-sm font-medium ${isRecording ? "bg-white text-red-600 shadow" : "text-gray-600"}`
              }, isRecording ? "Gravando..." : "Usar microfone")
            )
          ),
          h("textarea", {
            className: "w-full h-28 px-4 py-3 border rounded-lg focus:ring-2 focus:ring-indigo-500 resize-none mb-4",
            placeholder: "Digite a pergunta do recrutador...",
            value: question, onChange: e => setQuestion(e.target.value)
          }),
          h("div", { className: "flex items-center space-x-3" },
            h("button", {
              onClick: toggleMic,
              className: "px-4 py-3 rounded-lg bg-indigo-50 text-indigo-700 hover:bg-indigo-100"
            }, isRecording ? "🔴 Gravando..." : "🎤 Gravar pergunta"),
            h("button", {
              onClick: handleGenerate,
              className: "px-4 py-3 rounded-lg bg-gradient-to-r from-indigo-600 to-purple-600 text-white font-semibold"
            }, "⚡ Gerar resposta")
          )
        ),

        // Resposta
        answer && h("div", { className: "bg-indigo-50 border border-indigo-200 rounded-xl p-6 mb-6" },
          h("p", { className: "text-indigo-900 font-semibold mb-2" }, answer.title || "Resposta sugerida:"),
          h("p", { className: "text-indigo-900 leading-relaxed" }, answer.text)
        ),

        // Histórico
        h("div", { className: "bg-white rounded-xl shadow p-6" },
          h("div", { className: "flex items-center justify-between mb-3" },
            h("h3", { className: "font-semibold text-gray-900" }, "📜 Histórico da sessão"),
            h("span", { className: "text-xs text-gray-500" }, `${history.length} respostas`)
          ),
          history.length === 0
            ? h("p", { className: "text-gray-500" }, "Sem respostas ainda.")
            : h("div", { className: "space-y-4" },
                history.map((item, i) =>
                  h("div", { key: i, className: "border-l-4 border-indigo-600 pl-4" },
                    h("div", { className: "text-xs text-gray-500 mb-1" }, item.timestamp),
                    h("p", { className: "text-gray-700 font-medium mb-1" }, item.question),
                    h("p", { className: "text-gray-700" }, item.text)
                  )
                )
              )
        ),

        // Dica
        h("p", { className: "text-sm text-gray-500 mt-6 mb-10" },
          "💡 Dica: trocou a pergunta, o sistema limpa a resposta anterior para evitar confusão. " +
          "Use ‘Nova sessão’ quando mudar de CV e/ou vaga."
        )
      );
    }

    /* ========================
       App
       ======================== */

    function App() {
      const [ok, setOk] = useState(false);
      return ok ? h(Interview) : h(Login, { onOk: () => setOk(true) });
    }

    ReactDOM.createRoot(document.getElementById("app")).render(h(App));
  </script>
</body>
</html>
