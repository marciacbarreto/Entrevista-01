<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Entrevista IA â€” Login, Cruzamento e Respostas</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .card { box-shadow: 0 15px 40px rgba(31, 38, 135, 0.12); }
    .glass { backdrop-filter: blur(8px); }
  </style>
</head>
<body class="min-h-screen bg-gradient-to-br from-indigo-50 via-white to-purple-50">
  <div id="app"></div>

  <!-- React -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>

  <script>
    const { useState, useRef, createElement: h } = React;

    // ===== Utilidades de extraÃ§Ã£o de texto (local, sem APIs) =====
    function extractKeywords(text) {
      const t = (text || "").toLowerCase();
      const tools = [
        "power bi","excel","jira","trello","asana","zendesk","hubspot","salesforce",
        "freshdesk","intercom","looker","tableau","notion","monday","google data studio",
        "segment","mixpanel","postgres","mysql","airtable","metabase","crm","helpdesk","cx","cs"
      ];
      const metrics = ["nps","csat","ces","sla","churn","ltv","arr","mrr","retenc","expans","engaj"];
      const roles = ["customer success","cx","suporte","atendimento","opera","produto","marketing","vendas"];
      const found = (list) => list.filter(k => t.includes(k));
      return {
        tools: [...new Set(found(tools))],
        metrics: [...new Set(found(metrics))],
        roles: [...new Set(found(roles))]
      };
    }

    function capitalize(s){ return s.charAt(0).toUpperCase()+s.slice(1); }

    // ===== Gerador de resposta no MODELO EXECUTIVO E NATURAL =====
    function generateExecutiveAnswer({ question, resume, job }) {
      const rk = extractKeywords(resume);
      const jk = extractKeywords(job);

      // SeleÃ§Ã£o/combinaÃ§Ã£o simples para deixar a resposta mais â€œvivaâ€
      const tools = [...new Set([...(jk.tools||[]), ...(rk.tools||[])])].slice(0,3);
      const metrics = [...new Set([...(jk.metrics||[]), ...(rk.metrics||[])])].slice(0,3);
      const roleHint = (jk.roles[0] || rk.roles[0] || "customer experience");

      const toolsStr = tools.length ? tools.map(capitalize).join(", ") : "Power BI e CRM";
      const metricsStr = metrics.length ? metrics.map(s=>s.toUpperCase()).join(", ") : "NPS e CSAT";

      // MODELO aprovado por vocÃª:
      const resposta =
`Na minha Ãºltima experiÃªncia, comecei estruturando a Ã¡rea com foco em eficiÃªncia operacional e experiÃªncia do cliente.
Realizei um diagnÃ³stico dos fluxos de atendimento, identifiquei gargalos e implementei processos padronizados com acompanhamento via ${toolsStr}.
Desenvolvi um modelo de ${capitalize(roleHint)} com metas de ${metricsStr}, alÃ©m de integrar times de Suporte, CX e Produto para garantir uma visÃ£o Ãºnica do cliente.

Para esta oportunidade, aplicaria a mesma metodologia â€” iniciando pelo mapeamento da jornada, definiÃ§Ã£o de KPIs de retenÃ§Ã£o, engajamento e expansÃ£o.
Estabeleceria rituais de melhoria contÃ­nua (reviews semanais e mensais), usaria ${toolsStr} para monitoramento e criaria um playbook de relacionamento alinhado aos objetivos estratÃ©gicos da empresa.`;

      return resposta;
    }

    // ===== Login simples (local) =====
    function Login({ onAuth }) {
      const [email, setEmail]   = useState("");
      const [senha, setSenha]   = useState("");
      const [erro, setErro]     = useState("");

      const ok = () => {
        if (email === "admin@entrevistaia.com" && senha === "2025ia") {
          onAuth();
        } else {
          setErro("E-mail ou senha incorretos.");
        }
      };

      return h("div", { className: "min-h-screen flex items-center justify-center p-6" },
        h("div", { className: "card glass bg-white/90 rounded-2xl p-8 w-full max-w-md" },
          h("div", { className: "flex items-center gap-2 mb-6" },
            h("span", { className: "text-2xl" }, "ðŸ”’"),
            h("h1", { className: "text-2xl font-bold text-indigo-700" }, "Entrar no Entrevista IA")
          ),
          h("p", { className: "text-sm text-gray-600 mb-6" }, "Acesse sua sessÃ£o segura de respostas inteligentes para entrevistas."),
          h("input", {
            type: "email",
            placeholder: "E-mail",
            className: "w-full mb-3 px-4 py-3 border rounded-lg focus:ring-2 focus:ring-indigo-500",
            value: email, onChange: e=>setEmail(e.target.value)
          }),
          h("input", {
            type: "password",
            placeholder: "Senha",
            className: "w-full mb-4 px-4 py-3 border rounded-lg focus:ring-2 focus:ring-indigo-500",
            value: senha, onChange: e=>setSenha(e.target.value)
          }),
          erro && h("p", { className: "text-sm text-red-600 mb-4" }, erro),
          h("button", {
            onClick: ok,
            className: "w-full bg-gradient-to-r from-indigo-600 to-purple-600 text-white py-3 rounded-lg font-semibold"
          }, "Entrar")
        )
      );
    }

    // ===== Onboarding: CurrÃ­culo + Vaga =====
    function Onboarding({ onReady }) {
      const [resume, setResume] = useState("");
      const [job, setJob]       = useState("");

      return h("div", { className: "max-w-5xl mx-auto p-6" },
        h("div", { className: "mb-8 text-center" },
          h("div", { className: "inline-flex items-center justify-center w-16 h-16 rounded-2xl bg-gradient-to-br from-indigo-600 to-purple-600 text-white text-3xl" }, "âœ¨"),
          h("h2", { className: "text-3xl font-bold text-gray-900 mt-3" }, "Configurar sessÃ£o"),
          h("p", { className: "text-gray-600 mt-1" }, "Cole seu currÃ­culo e a descriÃ§Ã£o da vaga. O app cruza os dados e responde no tom executivo.")
        ),
        h("div", { className: "grid md:grid-cols-2 gap-6" },
          h("div", { className: "card bg-white rounded-xl p-6" },
            h("label", { className: "font-semibold text-gray-800" }, "CurrÃ­culo"),
            h("textarea", {
              className: "mt-2 w-full h-56 border rounded-lg p-3 focus:ring-2 focus:ring-indigo-500",
              placeholder: "Cole aqui seu currÃ­culo (experiÃªncias, ferramentas, resultados)...",
              value: resume, onChange: e=>setResume(e.target.value)
            })
          ),
          h("div", { className: "card bg-white rounded-xl p-6" },
            h("label", { className: "font-semibold text-gray-800" }, "DescriÃ§Ã£o da vaga"),
            h("textarea", {
              className: "mt-2 w-full h-56 border rounded-lg p-3 focus:ring-2 focus:ring-indigo-500",
              placeholder: "Cole aqui a vaga (responsabilidades, requisitos, mÃ©tricas, ferramentas)...",
              value: job, onChange: e=>setJob(e.target.value)
            })
          )
        ),
        h("div", { className: "mt-6 flex justify-center" },
          h("button", {
            disabled: !(resume.trim() && job.trim()),
            onClick: ()=>onReady({ resume, job }),
            className: "bg-gradient-to-r from-indigo-600 to-purple-600 disabled:opacity-50 text-white px-6 py-3 rounded-lg font-semibold"
          }, "Iniciar entrevista")
        )
      );
    }

    // ===== Modo Entrevista =====
    function Interview({ resume, job }) {
      const [question, setQuestion] = useState("");
      const [answer, setAnswer]     = useState("");
      const recRef = useRef(null);
      const [isRec, setIsRec]       = useState(false);

      const generate = () => {
        const r = generateExecutiveAnswer({ question, resume, job });
        setAnswer(r);
      };

      // Web Speech API (quando disponÃ­vel)
      const toggleRec = () => {
        const SR = window.SpeechRecognition || window.webkitSpeechRecognition;
        if (!SR) {
          alert("Captura de voz nÃ£o suportada neste navegador. Use o campo de texto.");
          return;
        }
        if (!isRec) {
          const r = new SR();
          recRef.current = r;
          r.lang = "pt-BR"; r.continuous = false; r.interimResults = false;
          r.onresult = (e)=> setQuestion(e.results[0][0].transcript || "");
          r.onerror = ()=> setIsRec(false);
          r.onend = ()=> setIsRec(false);
          r.start();
          setIsRec(true);
        } else {
          try { recRef.current && recRef.current.stop(); } catch(_) {}
          setIsRec(false);
        }
      };

      return h("div", { className: "max-w-5xl mx-auto p-6" },
        h("div", { className: "bg-white rounded-xl card p-6 mb-4 flex items-center justify-between" },
          h("div", null,
            h("h2", { className: "text-xl font-bold text-gray-900" }, "Modo Entrevista"),
            h("p", { className: "text-sm text-gray-600" }, "Digite ou fale a pergunta do recrutador. A resposta sai no tom executivo.")
          ),
          h("span", { className: "text-sm text-green-700 bg-green-50 px-3 py-1 rounded-full" }, "SessÃ£o ativa")
        ),
        h("div", { className: "bg-white rounded-xl card p-6 mb-6" },
          h("textarea", {
            className: "w-full h-28 border rounded-lg p-3 focus:ring-2 focus:ring-indigo-500",
            placeholder: "Ex.: Como vocÃª estruturaria a Ã¡rea de CX do zero nesta empresa?",
            value: question, onChange: e=>setQuestion(e.target.value)
          }),
          h("div", { className: "mt-4 flex gap-3 flex-wrap" },
            h("button", {
              onClick: toggleRec,
              className: `flex items-center gap-2 px-4 py-3 rounded-lg text-white ${isRec ? "bg-red-600" : "bg-indigo-600"}`
            }, isRec ? "ðŸ”´ Gravando..." : "ðŸŽ¤ Gravar pergunta"),
            h("button", {
              onClick: generate,
              className: "flex items-center gap-2 px-4 py-3 rounded-lg text-white bg-purple-600"
            }, "âš¡ Gerar resposta")
          )
        ),
        h("div", { className: "bg-indigo-50 border border-indigo-200 rounded-xl p-5" },
          h("p", { className: "font-semibold text-indigo-900 mb-2" }, "âœ¨ Resposta sugerida (modelo executivo e natural):"),
          h("pre", { className: "whitespace-pre-wrap text-indigo-900 leading-relaxed" }, answer || "Aguardo sua pergunta para gerar a melhor resposta baseada no seu currÃ­culo e na vaga.")
        ),
        h("p", { className: "mt-4 text-sm text-gray-500" }, "ðŸ’¡ Dica: use o microfone para capturar perguntas discretamente durante entrevistas online.")
      );
    }

    // ===== App principal =====
    function App(){
      const [auth, setAuth]         = useState(false);
      const [data, setData]         = useState(null);

      if (!auth) return h(Login, { onAuth: ()=>setAuth(true) });
      if (!data)  return h(Onboarding, { onReady: setData });

      return h(Interview, { resume: data.resume, job: data.job });
    }

    const root = ReactDOM.createRoot(document.getElementById("app"));
    root.render(h(App));
  </script>
</body>
</html>
