<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Entrevista IA - Respostas Inteligentes</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
</head>
<body class="bg-gradient-to-br from-indigo-50 via-white to-purple-50 min-h-screen">
  <div id="app"></div>

  <script>
    const { useState, useRef, useEffect, createElement: h } = React;

    // -------------------- LOGIN --------------------
    function Login({ onAuth }) {
      const [email, setEmail] = useState("");
      const [senha, setSenha] = useState("");
      const [erro, setErro] = useState("");

      const loginCorreto = "admin@entrevistaia.com";
      const senhaCorreta = "2025ia";

      const handleLogin = () => {
        if (email === loginCorreto && senha === senhaCorreta) {
          onAuth(true);
        } else {
          setErro("E-mail ou senha incorretos. Tente novamente.");
        }
      };

      return h("div", { className: "flex items-center justify-center min-h-screen" },
        h("div", { className: "bg-white p-8 rounded-2xl shadow-lg w-full max-w-sm text-center" },
          h("h1", { className: "text-3xl font-bold text-indigo-700 mb-2" }, "🔒 Entrar no Entrevista IA"),
          h("p", { className: "text-sm text-gray-600 mb-6" }, "Acesse sua sessão segura de entrevistas inteligentes."),
          h("input", {
            type: "email",
            placeholder: "E-mail",
            value: email,
            onChange: (e) => setEmail(e.target.value),
            className: "w-full mb-4 px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500"
          }),
          h("input", {
            type: "password",
            placeholder: "Senha",
            value: senha,
            onChange: (e) => setSenha(e.target.value),
            className: "w-full mb-4 px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500"
          }),
          erro && h("p", { className: "text-red-500 text-sm mb-4" }, erro),
          h("button", {
            onClick: handleLogin,
            className: "w-full bg-gradient-to-r from-indigo-600 to-purple-600 text-white py-3 rounded-lg font-semibold"
          }, "Entrar")
        )
      );
    }

    // -------------------- ONBOARDING --------------------
    function Onboarding({ onReady }) {
      const [resume, setResume] = useState("");
      const [job, setJob] = useState("");

      const handleStart = () => {
        if (resume.trim() && job.trim()) onReady({ resume, job });
      };

      return h("div", { className: "max-w-3xl mx-auto p-8" },
        h("div", { className: "bg-white rounded-2xl shadow-lg p-8" },
          h("h2", { className: "text-2xl font-bold text-indigo-700 mb-4" }, "📄 Nova Sessão de Entrevista"),
          h("p", { className: "text-gray-600 mb-6" }, "Cole seu currículo e a descrição da vaga para gerar respostas personalizadas."),
          h("label", { className: "block text-sm font-semibold mb-2" }, "Seu Currículo"),
          h("textarea", {
            className: "w-full h-40 p-3 border rounded-lg mb-6 focus:ring-2 focus:ring-indigo-500",
            placeholder: "Cole aqui seu currículo completo...",
            value: resume,
            onChange: (e) => setResume(e.target.value)
          }),
          h("label", { className: "block text-sm font-semibold mb-2" }, "Descrição da Vaga"),
          h("textarea", {
            className: "w-full h-40 p-3 border rounded-lg mb-6 focus:ring-2 focus:ring-indigo-500",
            placeholder: "Cole aqui a descrição completa da vaga...",
            value: job,
            onChange: (e) => setJob(e.target.value)
          }),
          h("button", {
            onClick: handleStart,
            className: "w-full bg-gradient-to-r from-indigo-600 to-purple-600 text-white py-3 rounded-lg font-semibold hover:opacity-90"
          }, "🚀 Iniciar Entrevista")
        )
      );
    }

    // -------------------- GERA RESPOSTA --------------------
    function capitalize(str) {
      return str.charAt(0).toUpperCase() + str.slice(1);
    }

    function extractKeywords(text) {
      const roles = [...text.matchAll(/Gerente|Líder|Coordenador|Analista|Especialista|Supervisor/gi)].map(m => m[0]);
      const tools = [...text.matchAll(/Power BI|Excel|CRM|Salesforce|Trello|Zendesk|Hubspot|Jira|OKR/gi)].map(m => m[0]);
      const metrics = [...text.matchAll(/NPS|CSAT|CES|Churn|Retenção|Expansão/gi)].map(m => m[0]);
      return { roles, tools, metrics };
    }

    function generateExecutiveAnswer({ question, resume, job }) {
      const rk = extractKeywords(resume);
      const jk = extractKeywords(job);

      const tools = [...new Set([...(jk.tools || []), ...(rk.tools || [])])].slice(0, 3);
      const metrics = [...new Set([...(jk.metrics || []), ...(rk.metrics || [])])].slice(0, 3);
      const roleHint = (jk.roles[0] || rk.roles[0] || "Customer Experience");

      const toolsStr = tools.length ? tools.map(capitalize).join(" e ") : "Power BI e Excel";
      const metricsStr = metrics.length ? metrics.map(s => s.toUpperCase()).join(" e ") : "NPS e CSAT";

      return `Na minha última experiência, comecei estruturando a área com foco em eficiência operacional e experiência do cliente.
Realizei um diagnóstico dos fluxos de atendimento, identifiquei gargalos e implementei processos padronizados com acompanhamento via ${toolsStr}.
Desenvolvi um modelo de ${capitalize(roleHint)} com metas de ${metricsStr}, além de integrar times de Suporte, CX e Produto para garantir uma visão única do cliente.

Para esta oportunidade, aplicaria a mesma metodologia — iniciando pelo mapeamento da jornada, definição de KPIs de retenção, engajamento e expansão.
Estabeleceria rituais de melhoria contínua (reviews semanais e mensais), usaria ${toolsStr} para monitoramento e criaria um playbook de relacionamento alinhado aos objetivos estratégicos da empresa.`;
    }

    // -------------------- MODO ENTREVISTA --------------------
    function Interview({ resume, job }) {
      const [question, setQuestion] = useState("");
      const [answer, setAnswer] = useState("");
      const recRef = useRef(null);
      const [isRec, setIsRec] = useState(false);

      useEffect(() => {
        if (question.trim().length > 5) {
          const r = generateExecutiveAnswer({ question, resume, job });
          setAnswer(r);
        } else setAnswer("");
      }, [question, resume, job]);

      const toggleRec = () => {
        const SR = window.SpeechRecognition || window.webkitSpeechRecognition;
        if (!SR) {
          alert("Captura de voz não suportada neste navegador.");
          return;
        }
        if (!isRec) {
          const r = new SR();
          recRef.current = r;
          r.lang = "pt-BR";
          r.onresult = (e) => setQuestion(e.results[0][0].transcript || "");
          r.onend = () => setIsRec(false);
          r.start();
          setIsRec(true);
        } else {
          recRef.current && recRef.current.stop();
          setIsRec(false);
        }
      };

      return h("div", { className: "max-w-5xl mx-auto p-6" },
        h("div", { className: "bg-white rounded-xl shadow p-6 mb-4 flex justify-between" },
          h("div", null,
            h("h2", { className: "text-xl font-bold text-gray-900" }, "🎯 Modo Entrevista"),
            h("p", { className: "text-sm text-gray-600" }, "Digite ou fale a pergunta do recrutador. A resposta sai no tom executivo.")
          ),
          h("span", { className: "text-sm text-green-700 bg-green-50 px-3 py-1 rounded-full" }, "Sessão ativa")
        ),
        h("div", { className: "bg-white rounded-xl shadow p-6 mb-6" },
          h("textarea", {
            className: "w-full h-28 border rounded-lg p-3 focus:ring-2 focus:ring-indigo-500",
            placeholder: "Ex.: Como você estruturaria a área de CX do zero nesta empresa?",
            value: question,
            onChange: e => setQuestion(e.target.value)
          }),
          h("div", { className: "mt-4 flex gap-3 flex-wrap" },
            h("button", {
              onClick: toggleRec,
              className: `flex items-center gap-2 px-4 py-3 rounded-lg text-white ${isRec ? "bg-red-600" : "bg-indigo-600"}`
            }, isRec ? "🔴 Gravando..." : "🎤 Gravar pergunta"),
            h("button", {
              onClick: () => {
                const r = generateExecutiveAnswer({ question, resume, job });
                setAnswer(r);
              },
              className: "flex items-center gap-2 px-4 py-3 rounded-lg text-white bg-purple-600"
            }, "⚡ Gerar resposta")
          )
        ),
        h("div", { className: "bg-indigo-50 border border-indigo-200 rounded-xl p-5" },
          h("p", { className: "font-semibold text-indigo-900 mb-2" }, "✨ Resposta sugerida (modelo executivo e natural):"),
          h("pre", { className: "whitespace-pre-wrap text-indigo-900 leading-relaxed" },
            answer || "Aguardando pergunta..."
          )
        ),
        h("p", { className: "mt-4 text-sm text-gray-500" },
          "💡 Dica: use o microfone para capturar perguntas discretamente durante entrevistas online.")
      );
    }

    // -------------------- APLICAÇÃO PRINCIPAL --------------------
    function App() {
      const [auth, setAuth] = useState(false);
      const [data, setData] = useState(null);
      const [sessionKey, setSessionKey] = useState(Date.now());

      const handleNewSession = () => {
        setData(null);
        setSessionKey(Date.now());
      };

      if (!auth) return h(Login, { onAuth: () => setAuth(true) });
      if (!data)
        return h(Onboarding, {
          key: sessionKey,
          onReady: (newData) => setData({ resume: newData.resume.trim(), job: newData.job.trim() }),
        });

      return h("div", null,
        h("div", { className: "flex justify-between items-center p-4 bg-white/70 border-b mb-2" },
          h("h1", { className: "font-semibold text-indigo-700" }, "🧩 Sessão de Entrevista Ativa"),
          h("button", {
            onClick: handleNewSession,
            className: "px-4 py-2 bg-gradient-to-r from-indigo-500 to-purple-500 text-white rounded-lg hover:opacity-90"
          }, "🆕 Nova Vaga / Currículo")
        ),
        h(Interview, { key: sessionKey, resume: data.resume, job: data.job })
      );
    }

    const root = ReactDOM.createRoot(document.getElementById("app"));
    root.render(h(App));
  </script>
</body>
</html>

